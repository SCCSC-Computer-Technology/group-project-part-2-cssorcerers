@using SportsData.Models
@model NBAPlayersStatsViewModel
@{
	//Layout = "_layout";
	ViewData["title"] = "NBA Player Stats";
}

<head>
	<link rel="stylesheet" href="~/css/common.css">
	<style>
		.btn {
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
			height: 70px;
		}
	</style>
</head>

<!--Sorting and navigation-->
<div style="display: flex; gap: 10px;">

	<!--Page numbers-->
	<div style="width: 160px;">
		<p style="margin-bottom: 2px; margin-right: 10px; float: left; text-align: center;">Page</p>
		<br />
		<div style="display: flex; gap: 10px; float: left;">
			<input type="text" min="1" max="@Model.MaxPage" id="pageInput" value="@Model.CurrentPage" style="text-align: right; margin-top: 3px; width: 80px; height: 20px" />
			<p> / @Model.MaxPage</p>
		</div>
	</div>

	<!--Active selection-->
	<div class="dropdown" style="margin-bottom: 10px; width: 100px;">
		<p style="color: black; text-align: left; margin-bottom: 2px;">Status</p>
		<select id="activeSelect" onchange="LoadActive()" style="float: left">
			<option>Any</option>
			<option>Active</option>
			<option>Retired</option>
		</select>
	</div>
</div>



<div style="display: flex; gap: 10px;">
	<a class="btn btn-primary" style="background-color:darkblue; height: 40px" asp-controller="nba" asp-action="players"
	   asp-route-page="1" asp-route-active="@(Model.IsActive.HasValue ? Model.IsActive.Value : "all")"
	   asp-route-team="@Model.TeamID" asp-route-sort="@Model.SortOrder" role="button">&lt;&lt;</a>

	<a class="btn btn-primary" style="background-color:darkblue; height: 40px" asp-controller="nba" asp-action="players"
	   asp-route-page="@(Model.CurrentPage > 1 ? Model.CurrentPage-1 : 1)" asp-route-active="@(Model.IsActive.HasValue ? Model.IsActive.Value : "all")"
	   asp-route-team="@Model.TeamID" asp-route-sort="@Model.SortOrder" role="button">&lt;</a>

	<a class="btn btn-primary" style="background-color:darkblue; height: 40px" asp-controller="nba" asp-action="players"
	   asp-route-page="@(Model.CurrentPage < Model.MaxPage ? Model.CurrentPage+1 : Model.MaxPage)" asp-route-active="@(Model.IsActive.HasValue ? Model.IsActive.Value : "all")"
	   asp-route-team="@Model.TeamID" asp-route-sort="@Model.SortOrder" role="button">&gt;</a>

	<a class="btn btn-primary" style="background-color:darkblue; height: 40px" asp-controller="nba" asp-action="players"
	   asp-route-page="@Model.MaxPage" asp-route-active="@(Model.IsActive.HasValue ? Model.IsActive.Value : "all")"
	   asp-route-team="@Model.TeamID" asp-route-sort="@Model.SortOrder" role="button">&gt;&gt;</a>
</div>


<table class="table table-hover table-light table-striped" style="margin-top: 10px; overflow-x: clip; overflow-y: scroll; border: 2px ridge darkblue; width: 140%; table-layout: fixed; vertical-align: middle;">
	<thead style="text-align: center; vertical-align: middle; padding: 0px;">
		<tr style="height: 50px;">
			<td id="headCell" style="width:100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "name_asc" ? "name_desc" : "name_asc")">
					Player
				</a>
			</td>
			<td id="headCell" style="width: 100px;">
				Team
			</td>
			<td id="headCell" style="width:80px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "ssn_asc" ? "ssn_desc" : "ssn_asc")">
					Status
				</a>
			</td>

			<td id="headCell" style="width: 100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "fg_asc" ? "fg_desc" : "fg_asc")">
					Field Goals
				</a>
			</td>
			<td id="headCell" style="width: 100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "3pt_asc" ? "3pt_desc" : "3pt_asc")">
					Three Pointers
				</a>
			</td>
			<td id="headCell" style="width: 100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "2pt_asc" ? "2pt_desc" : "2pt_asc")">
					Two Pointers
				</a>
			</td>
			<td id="headCell" style="width:100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "ft_asc" ? "ft_desc" : "ft_asc")">
					Free Throws
				</a>
			</td>
			<td id="headCell" style="width:100px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "offr_asc" ? "offr_desc" : "offr_asc")">
					Offensive Rebounds
				</a>
			</td>
			<td id="headCell" style="width:110px;">
				<a class="btn" style="width:110px" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "defr_asc" ? "defr_desc" : "defr_asc")">
					Defensive Rebounds
				</a>
			</td>
			<td id="headCell" style="width:80px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "ast_asc" ? "ast_desc" : "ast_asc")">
					Assists
				</a>
			</td>
			<td id="headCell" style="width:80px;">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "stl_asc" ? "stl_desc" : "stl_asc")">
					Steals
				</a>
			</td>
			<td id="headCell" style="width: 80px">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "blk_asc" ? "blk_desc" : "blk_asc")">
					Blocks
				</a>
			</td>
			<td id="headCell" style="width: 90px">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "tnvr_asc" ? "tnvr_desc" : "tnvr_asc")">
					Turn overs
				</a>
			</td>
			<td id="headCell" style="width: 80px">
				<a class="btn" asp-controller="nba" asp-action="players"
				   asp-route-page="@Model.CurrentPage" asp-route-sort="@(Model.SortOrder == "tpt_asc" ? "tpt_desc" : "tpt_asc")">
					Total Points
				</a>
			</td>
		</tr>
	</thead>
	@if (Model != null)
	{
		<tbody style="text-align: center; padding: 5px; vertical-align: middle;">
			@foreach (NBAPlayerInfo stat in Model.nbaPlayers)
			{

				<tr style="vertical-align: middle;" onclick="Redirect('/nba/player?id=@stat.NBAPlayer?.ID')">
					<td id="keyCell">
						@(stat.NBAPlayer?.Name ?? "Unknown")
					</td>

					<td id="dataCell" >
						@(stat.TeamName ?? "None")
					</td>

					<td id="dataCell" >
						@(stat.NBAPlayer.IsActive ? "Active" : "Retired")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.FieldGoals?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.ThreePoints?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.TwoPoints?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.FreeThrows?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.OffensiveRebounds?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.DefesniveRebounds?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.Assists?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.Steals?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.Blocks?.ToString() ?? "N/A")
					</td>

					<td id="dataCell">
						@(stat.CareerStats?.Turnovers?.ToString() ?? "N/A")
					</td>


					<td id="dataCell">
						@(stat.CareerStats?.TotalPoints?.ToString() ?? "N/A")
					</td>
				</tr>

			}
		</tbody>
	}
</table>

<script>

	window.onload = SetActiveSelection();

	function SetActiveSelection()
	{
		let isActive = "@(!Model.IsActive.HasValue ? "null" : Model.IsActive)";
		if(isActive != "null")
		{
			
			document.getElementById('activeSelect').value = isActive === "True" ? "Active" : "Retired";
		}
		else
		{
			document.getElementById('activeSelect').value = "Any";
		}
	}

	let pageInput = document.getElementById('pageInput');
	pageInput.addEventListener('keydown', function(event)
	{
		if(event.key === 'Enter')
		{
			let page = Number(pageInput.value);
			if(!isNaN(page))
			{
				
				let teamID = @Model.TeamID;
				let isActive = "@(Model.IsActive.HasValue ? (Model.IsActive.Value ? "true" : "false") : "all")";
				let sort = "@(Model.SortOrder != "" ? Model.SortOrder : "default")";
				window.location.href = `/nba/players?page=${page}&team=${teamID}&active=${isActive}&sort=${sort}`;
			}
			else
			{
				alert("Page number must be numeric");
				pageInput.value = @Model.CurrentPage;
			}
		}
	});

	function Redirect(link)
	{
		window.open(link, "_blank");
	}

	function LoadActive()
	{
		let isActive = document.getElementById("activeSelect").value;
		window.location.href = `/nba/players?active=${isActive == "Active" ? "True" : isActive == "Retired" ? "False" : isActive}`;
	}
</script>
